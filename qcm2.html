<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz PostgreSQL - Optimisation SQL</title>
<style>
  body {
    font-family: "Inter", sans-serif;
    background: #f4f7fa;
    color: #222;
    padding: 20px;
    max-width: 900px;
    margin: auto;
  }
  h1, h2 { text-align: center; color: #0a3d62; }
  .menu, .quiz-box {
    background: white;
    padding: 20px;
    margin-top: 30px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  button {
    display: block;
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    font-size: 1em;
    border: none;
    border-radius: 8px;
    background: #0a3d62;
    color: white;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover { background: #07406b; }
  .choices button {
    background: #fff;
    border: 1px solid #ccc;
    color: #222;
  }
  .choices button:hover { background: #f0f0f0; }
  .choices button.correct { background: #c8e6c9; border-color: #2e7d32; }
  .choices button.incorrect { background: #ffcdd2; border-color: #c62828; }
  .explanation {
    margin-top: 10px;
    background: #e3f2fd;
    padding: 10px;
    border-left: 4px solid #1976d2;
    border-radius: 6px;
  }
  #timer {
    text-align: right;
    font-weight: bold;
    color: #c62828;
  }
</style>
</head>
<body>

<h1>üéì Quiz PostgreSQL - Optimisation & Analyse</h1>
<div id="app"></div>

<script>
/* =============================
   DONN√âES DES QUIZZ
============================= */

// --- Quiz 1 : Concepts et plans d'ex√©cution ---
const quiz1 = [
  {q:"Quel mot-cl√© affiche le plan d‚Äôex√©cution d‚Äôune requ√™te ?",c:["SHOW PLAN","EXPLAIN","EXPLAIN ANALYZE","DESCRIBE"],a:2,e:"EXPLAIN ANALYZE ex√©cute la requ√™te et affiche le plan r√©el avec les temps mesur√©s."},
  {q:"Qu‚Äôest-ce qu‚Äôun 'Seq Scan' ?",c:["Lecture s√©quentielle de la table enti√®re","Recherche via un index","Tri des lignes","Lecture en m√©moire"],a:0,e:"PostgreSQL lit toute la table ligne par ligne, sans index."},
  {q:"Pourquoi PostgreSQL utilise le parall√©lisme ?",c:["Pour les petites requ√™tes","Pour r√©partir le travail entre plusieurs processus","Pour corriger des erreurs","Pour r√©duire la m√©moire"],a:1,e:"Le parall√©lisme acc√©l√®re les requ√™tes volumineuses en divisant le travail."},
  {q:"Que signifie 'Rows Removed by Filter' ?",c:["Lignes rejet√©es par WHERE","Lignes tri√©es","Lignes modifi√©es","Lignes ins√©r√©es"],a:0,e:"Ce sont les lignes lues mais √©cart√©es par le filtre WHERE."},
  {q:"Que fait EXPLAIN sans ANALYZE ?",c:["Ex√©cute la requ√™te","Affiche seulement le plan estim√©","Cr√©e un index","Efface les statistiques"],a:1,e:"EXPLAIN seul n‚Äôex√©cute pas la requ√™te, il montre les estimations."},
  {q:"Que signifie 'Cost' dans EXPLAIN ?",c:["Le temps en secondes","Une estimation du co√ªt relatif pour le planificateur","Le prix du CPU","Le co√ªt de stockage"],a:1,e:"C‚Äôest un co√ªt estim√© utilis√© pour comparer les plans possibles."},
  {q:"Quel mot-cl√© force PostgreSQL √† ignorer les index ?",c:["IGNORE INDEX","SET enable_indexscan = off","NO INDEX","EXPLAIN SIMPLE"],a:1,e:"Le param√®tre enable_indexscan peut √™tre d√©sactiv√© temporairement."},
  {q:"Pourquoi EXPLAIN ANALYZE peut √™tre plus lent ?",c:["Il fait un tri suppl√©mentaire","Il ex√©cute r√©ellement la requ√™te","Il analyse les index","Il met √† jour les statistiques"],a:1,e:"EXPLAIN ANALYZE ex√©cute la requ√™te pour mesurer le temps r√©el."}
];

// --- Quiz 2 : Connaissances th√©oriques ---
const quiz2 = [
  {q:"Quand un index est-il le plus efficace ?",c:["Sur une colonne peu distincte","Sur une colonne avec beaucoup de valeurs uniques","Sur une cl√© √©trang√®re uniquement","Sur toutes les colonnes"],a:1,e:"Les index sont utiles sur les colonnes √† forte cardinalit√©."},
  {q:"Quel type d‚Äôindex est utilis√© par d√©faut dans PostgreSQL ?",c:["B-Tree","GIN","GiST","Hash"],a:0,e:"B-Tree est l‚Äôindex par d√©faut."},
  {q:"Quel est l‚Äôint√©r√™t d‚Äôun index composite ?",c:["Acc√©l√©rer les jointures","Combiner plusieurs colonnes pour les filtres","Optimiser les insertions","R√©duire la taille du cache"],a:1,e:"Un index composite aide sur plusieurs colonnes du WHERE."},
  {q:"Que fait la commande ANALYZE ?",c:["Analyse les index","Met √† jour les statistiques du planificateur","V√©rifie les contraintes","Trie les tables"],a:1,e:"ANALYZE collecte des statistiques pour le planificateur."},
  {q:"Pourquoi un 'covering index' est-il performant ?",c:["Il contient toutes les colonnes n√©cessaires √† la requ√™te","Il √©vite les tri","Il r√©duit la taille de la table","Il d√©sactive le cache"],a:0,e:"Un covering index permet d‚Äô√©viter la lecture du heap."},
  {q:"Que fait VACUUM ?",c:["Trie la table","Supprime les lignes mortes et lib√®re l‚Äôespace","Met √† jour les index","Supprime les contraintes"],a:1,e:"VACUUM nettoie les tuples obsol√®tes."},
  {q:"Que signifie la s√©lectivit√© d‚Äôun index ?",c:["La proportion de lignes uniques","Le taux d‚Äôerreur","Le taux de compression","Le nombre d‚Äôindex utilis√©s"],a:0,e:"Plus la s√©lectivit√© est haute, plus l‚Äôindex est utile."},
  {q:"Quand le parall√©lisme est-il activ√© ?",c:["Quand le co√ªt estim√© est √©lev√©","Toujours","Jamais pour SELECT","Uniquement pour INSERT"],a:0,e:"PostgreSQL choisit le parall√©lisme quand le co√ªt justifie plusieurs workers."}
];

// --- Quiz 3 : Techniques SQL ---
const quiz3 = [
  {q:"Quelle requ√™te affiche les titres de 2020 ?",c:["SELECT * FROM title_basics WHERE start_year='2020';","SELECT * FROM title_basics WHERE start_year=2020;","SELECT title FROM title_basics WHERE year=2020;","SELECT ALL FROM title_basics START YEAR 2020;"],a:1,e:"Les ann√©es sont des entiers ‚Üí start_year=2020."},
  {q:"Quelle requ√™te compte le nombre de films par ann√©e ?",c:["SELECT start_year, COUNT(*) FROM title_basics WHERE title_type='movie' GROUP BY start_year;","SELECT COUNT(start_year) FROM title_basics;","SELECT DISTINCT start_year FROM title_basics;","SELECT COUNT(*) FROM title_basics;"],a:0,e:"GROUP BY permet d‚Äôagr√©ger par ann√©e les films."},
  {q:"Quelle requ√™te fait une jointure entre title_basics et title_ratings ?",c:["SELECT * FROM title_basics JOIN title_ratings USING (tconst);","SELECT * FROM title_basics, title_ratings;","SELECT * FROM title_basics LEFT tconst title_ratings;","SELECT JOIN title_basics, title_ratings;"],a:0,e:"JOIN ... USING(tconst) relie les deux tables sur tconst."},
  {q:"Quelle commande cr√©e un index sur start_year ?",c:["CREATE INDEX idx_year ON title_basics (start_year);","ADD INDEX title_basics.start_year;","INDEX start_year ON title_basics;","ALTER TABLE title_basics ADD INDEX start_year;"],a:0,e:"CREATE INDEX est la syntaxe correcte."},
  {q:"Quelle requ√™te s√©lectionne les films de 1994 not√©s plus de 8.5 ?",c:["SELECT b.primary_title, r.average_rating FROM title_basics b JOIN title_ratings r ON b.tconst=r.tconst WHERE b.start_year=1994 AND r.average_rating>8.5;","SELECT * FROM title_basics WHERE start_year=1994 AND average_rating>8.5;","SELECT JOIN title_ratings WHERE start_year=1994;","SELECT primary_title, average_rating FROM title_ratings WHERE average_rating>8.5;"],a:0,e:"Il faut joindre basics et ratings pour filtrer sur les deux tables."},
  {q:"Comment supprimer un index nomm√© idx_year ?",c:["DELETE INDEX idx_year;","DROP INDEX idx_year;","REMOVE INDEX idx_year;","ALTER TABLE DROP INDEX idx_year;"],a:1,e:"DROP INDEX est la syntaxe correcte."},
  {q:"Comment voir les index d‚Äôune table ?",c:["\di table","SHOW INDEX table;","SELECT * FROM pg_indexes WHERE tablename='table';","DESCRIBE INDEX table;"],a:2,e:"La vue pg_indexes liste les index existants."},
  {q:"Quelle requ√™te renvoie le titre et la note d‚Äôun film sp√©cifique ?",c:["SELECT b.primary_title, r.average_rating FROM title_basics b JOIN title_ratings r ON b.tconst=r.tconst WHERE b.tconst='tt0111161';","SELECT * FROM title_basics WHERE tconst='tt0111161';","SELECT tconst FROM title_ratings;","SELECT * FROM title_basics LIMIT 1;"],a:0,e:"On joint basics et ratings pour obtenir le titre et sa note."}
];

/* =============================
   LOGIQUE DE L'APPLICATION
============================= */
let currentQuiz = [];
let currentIndex = 0;
let score = 0;
let timer;
let timeLeft = 600; // 10 minutes

function showMenu() {
  document.getElementById('app').innerHTML = `
    <div class="menu">
      <h2>Choisissez votre quiz :</h2>
      <button onclick="startQuiz(1)">Quiz 1 ‚Äì Concepts et plan d‚Äôex√©cution</button>
      <button onclick="startQuiz(2)">Quiz 2 ‚Äì Connaissances th√©oriques</button>
      <button onclick="startQuiz(3)">Quiz 3 ‚Äì Techniques SQL</button>
      <button onclick="startExam()">üß† Mode Examen (20 questions al√©atoires)</button>
    </div>
  `;
}

function startQuiz(n) {
  currentQuiz = n===1?quiz1:n===2?quiz2:quiz3;
  initQuiz();
}

function startExam() {
  const all = [...quiz1, ...quiz2, ...quiz3];
  currentQuiz = shuffle(all).slice(0,20);
  initQuiz(true);
}

function initQuiz(exam=false){
  currentIndex=0; score=0;
  if(exam){
    timeLeft=600;
    startTimer();
  } else clearInterval(timer);
  showQuestion();
}

function startTimer(){
  clearInterval(timer);
  timer=setInterval(()=>{
    timeLeft--;
    document.getElementById('timer').innerText = `‚è±Ô∏è Temps restant : ${Math.floor(timeLeft/60)}:${String(timeLeft%60).padStart(2,'0')}`;
    if(timeLeft<=0){
      clearInterval(timer);
      showResult(true);
    }
  },1000);
}

function showQuestion(){
  const q=currentQuiz[currentIndex];
  document.getElementById('app').innerHTML=`
    <div class="quiz-box">
      <div id="timer"></div>
      <h2>Question ${currentIndex+1}/${currentQuiz.length}</h2>
      <p><strong>${q.q}</strong></p>
      <div class="choices">
        ${q.c.map((ch,i)=>`<button onclick="checkAnswer(${i})">${ch}</button>`).join("")}
      </div>
    </div>`;
  if(timer) document.getElementById('timer').innerText = `‚è±Ô∏è Temps restant : ${Math.floor(timeLeft/60)}:${String(timeLeft%60).padStart(2,'0')}`;
}

function checkAnswer(i){
  const q=currentQuiz[currentIndex];
  const buttons=document.querySelectorAll('.choices button');
  buttons.forEach((btn,idx)=>{
    btn.disabled=true;
    if(idx===q.a) btn.classList.add('correct');
    if(idx===i && i!==q.a) btn.classList.add('incorrect');
  });
  const result=document.createElement('div');
  result.classList.add('explanation');
  const ok=i===q.a;
  if(ok) score++;
  result.innerHTML=`${ok?"‚úÖ Bonne r√©ponse !":`‚ùå Mauvaise r√©ponse.<br><strong>Bonne :</strong> ${q.c[q.a]}`}<br>${q.e}<br><br><button onclick="nextQuestion()">Suivant</button>`;
  document.querySelector('.quiz-box').appendChild(result);
}

function nextQuestion(){
  currentIndex++;
  if(currentIndex<currentQuiz.length) showQuestion();
  else showResult();
}

function showResult(timeout=false){
  clearInterval(timer);
  const note = Math.round((score/currentQuiz.length)*100);
  document.getElementById('app').innerHTML=`
    <div class="menu">
      <h2>${timeout?"‚è∞ Temps √©coul√© !":"üéâ Quiz termin√© !"}</h2>
      <p>Score : ${score}/${currentQuiz.length} (${note}/100)</p>
      <button onclick="showMenu()">Retour au menu principal</button>
    </div>`;
}

function shuffle(arr){return arr.sort(()=>Math.random()-0.5);}
showMenu();
</script>

</body>
</html>
